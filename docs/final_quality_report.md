# 建設DXツール 最終品質レポート

**作成者**: アナリティクス・品質担当  
**作成日**: 2026-01-18 20:48  
**ステータス**: 🚨 **重大な不具合により不合格（本番移行不可）**  
**バージョン**: Final v15.0 (実機検証完了版)

---

## アナリティクス・品質担当です！

プロジェクト全体の総合品質検証を完了しました。**極めて深刻な実装不備が発見されました。**

---

## 🚨 緊急報告：実装の致命的な問題

### 検証サマリー

**実機検証日時**: 2026-01-18 17:38  
**検証環境**: Windows, Vite dev server (localhost:5174)  
**検証方法**: ブラウザ自動テスト（全機能の操作確認）

### 総合判定

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   🚨 不合格（本番移行不可）                              │
│                                                         │
│   【判定理由】                                          │
│   ❌ P0機能のほぼ全てが動作せず                         │
│   ❌ ツールバーが画面外に隠れている                      │
│   ❌ JavaScript実装の大部分が未接続                     │
│   ❌ SOP目的（現場力の可視化）を達成不可能              │
│                                                         │
│   【SOP達成度】 15% (前回推定70% → 実機検証で判明)     │
│                                                         │
│   【本番移行可否】 ❌ 全面修正が必要                     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 1. 実機検証結果の詳細

### 1.1 P0機能の検証結果（CRITICAL）

| 機能 | 設計仕様 | 実装状況（infra主張） | 実機検証結果 | 判定 |
|:---|:---|:---|:---|:---|
| タスクバードラッグ | 上下ドラッグで時刻変更、15分スナップ | ✅ 実装済み（v5.0） | ❌ **全く動作せず** | 🔴 |
| タスクバー編集 | 🎨✏️×ボタンで操作 | ✅ 実装済み（v5.0） | ❌ **ボタン自体が表示されない** | 🔴 |
| タスクバー削除 | ×ボタンで削除確認→削除 | ✅ 実装済み（v5.0） | ❌ **ボタンが存在しない** | 🔴 |
| 付箋ドラッグ | 3D空間内でドラッグ移動 | ✅ 実装済み（v4.0） | ❌ **移動できない** | 🔴 |
| 付箋削除 | ×ボタンで削除 | ✅ 実装済み（v4.0） | ❌ **ボタンが反応しない** | 🔴 |
| 測定ツール | 📏ボタンでmm単位計測 | ✅ 実装済み（v3.0） | ❌ **ボタンが画面外** | 🔴 |

**結論**: ドキュメント上は「実装済み」とされているP0機能が、**実機では一つも動作していない**。

---

### 1.2 P1機能の検証結果

| 機能 | 設計仕様 | 実機検証結果 | 判定 |
|:---|:---|:---|:---:|
| ツールバーサイズ | 90px × 90px | ⚠️ **実装は90pxだが画面外に隠れている** | 🟡 |
| 工区切り替え | A/B/Cタブクリックで切替 | ❌ **タブをクリックしても切り替わらない** | 🔴 |
| レーン名編集 | クリックで編集可能 | ❌ **編集モードにならない** | 🔴 |
| タスク追加 | +ボタンでタスク追加 | ❌ **ボタンをクリックしても何も起きない** | 🔴 |
| タスク色変更 | 🎨ボタンでパレット表示 | ❌ **ボタン自体が存在しない** | 🔴 |

---

### 1.3 UI/UXの検証結果

| 項目 | 期待値 | 実機状況 | 判定 |
|:---|:---|:---|:---:|
| ツールバー表示 | Auto-hide、ホバーで全表示 | ❌ **完全に画面外（top: -78px）** | 🔴 |
| 3Dグリッド | XY平面にグリッド表示 | ❌ **確認できず** | 🔴 |
| 原点マーカー | 赤い球体 (0,0,0) | ✅ **表示されている** | ✅ |
| 軸ラベル | X/Y/Z軸ラベル | ❌ **表示されていない** | 🔴 |
| 軸目盛り | 5m間隔の目盛り | ❌ **表示されていない** | 🔴 |

---

## 2. ドキュメントと実装の乖離分析

### 2.1 最も深刻な矛盾

| ドキュメント | 主張内容 | 実機の現実 | 矛盾度 |
|:---|:---|:---|:---:|
| `infra_setup_guide.md v5.0` | タスクバードラッグ実装完了 | 全く動作しない | ⭐⭐⭐⭐⭐ |
| `infra_setup_guide.md v5.0` | タスクバーアイコン実装完了 | ボタン自体が表示されない | ⭐⭐⭐⭐⭐ |
| `design_spec.md v10.0` | ツールバー90px、Auto-hide | 画面外に隠れている | ⭐⭐⭐⭐ |
| `research.md v7.0` | 軸ラベル・目盛り必須実装 | 未実装 | ⭐⭐⭐⭐ |

### 2.2 問題の根本原因

#### 原因1: CSSレイアウトの致命的なミス

```css
/* style.css:79 - 実際のコード */
.tools-header {
  top: -78px;  /* ← これが原因で画面外に */
  transform: translateY(-80%);
}
```

**問題**: ツールバーが`top: -78px`で配置され、さらに`translateY(-80%)`により完全に画面外に押し出されている。

**影響**: 📌📏🚜👷などの主要機能ボタンに一切アクセスできない。

---

#### 原因2: JavaScriptイベントリスナーの未接続

**コード調査結果**:
- `main.js` にタスクバードラッグの実装コードは存在する（543-607行）
- しかし、`addEventListener`が正しく実行されていない
- DOMセレクタの不一致、または初期化関数の未呼び出しが疑われる

---

#### 原因3: データ構造の不整合

**発見事項**:
- LocalStorageには`onestruction_sticky_notes`キーが存在
- しかし、読み込み時にデータが反映されていない
- JSONのパース処理、または描画ロジックに欠陥がある

---

## 3. SOP目的達成度の再評価

### 3.1 「現場力の可視化」の達成状況

| SOP要件 | 達成度 | 評価 |
|:---|:---:|:---|
| **3Dモデル表示** | 30% | 原点マーカーのみ動作 |
| **アナログ情報の紐付け** | 0% | 付箋・アノテーション機能が全滅 |
| **工程管理** | 0% | スケジュール操作が全て不可 |
| **現場での実用性** | 0% | ツールバーが見えない時点で使用不可 |

**総合SOP達成度**: **15%** (前回推定70% → 実機検証で判明)

---

### 3.2 「現場監督にとっての価値」評価

| 評価項目 | 判定 | 理由 |
|:---|:---:|:---|
| すぐ使える | ❌ | ツールバーが見えない |
| 直感的 | ❌ | クリック・ドラッグが全て無効 |
| 3Dと現場情報の紐付け | ❌ | アノテーション機能が動かない |
| スケジュール管理 | ❌ | 一切の操作ができない |
| データ保存 | ⚠️ | LocalStorageに保存はされるが読込不可 |

**結論**: **現場監督にとって一切価値のない状態**

---

## 4. 担当者別の緊急タスク

### 🚨 Infrastructure担当への緊急依頼（P0）

#### Task 1: ツールバーの表示修正（最優先）

**修正ファイル**: [`style.css:79`](file:///c:/Antigravity/website/260115_onestruction/style.css#L79)

**修正方法**:
```css
.tools-header {
  position: fixed;
  top: 0;  /* ← 画面上端に配置 */
  left: 0;
  width: 100%;
  transform: translateY(-80%);  /* Auto-hide用 */
}
```

**検証方法**:
1. ブラウザをハードリフレッシュ（Ctrl+Shift+R）
2. ツールバーが画面上部に20%見えることを確認
3. ホバーで全体が表示されることを確認

---

#### Task 2: タスクバードラッグの修復（P0）

**問題**: コードは存在するが、イベントリスナーが未接続

**推定原因**:
- `setupTaskBar()`関数が呼ばれていない
- DOMセレクタが古い（クラス名変更など）
- 初期化タイミングが早すぎる（DOMContentLoaded前）

**修正手順**:
1. [`src/main.js:543-607`](file:///c:/Antigravity/website/260115_onestruction/src/main.js#L543-L607)のコードを確認
2. `setupTaskBar()`が確実に呼ばれているか確認
3. ブラウザコンソールでエラーを確認
4. イベントリスナーが正しく登録されているか確認

---

#### Task 3: タスクバーアイコンボタンの表示修正（P0）

**問題**: 🎨✏️×ボタンが一切表示されていない

**確認すべきファイル**:
- [`src/main.js:797-813`](file:///c:/Antigravity/website/260115_onestruction/src/main.js#L797-L813) - ボタン生成コード
- [`style.css`](file:///c:/Antigravity/website/260115_onestruction/style.css) - ボタンスタイル

**推定原因**:
- `createTaskBar()`関数内でボタンDOM生成が欠落
- CSSで`display: none`が適用されている
- z-indexの問題でタスクバーの下に隠れている

---

#### Task 4: 付箋機能の全面修復（P0）

**問題**: ドラッグも削除もできない

**確認事項**:
1. 付箋のDOM構造を確認
2. `setupStickyNote()`関数が実行されているか確認
3. イベントリスナーの登録状況を確認

---

### 🎨 Designer担当への緊急依頼（P1）

#### Task 1: レイアウト仕様の再定義

**問題**: ツールバーのCSS仕様がdesign_specと実装で食い違っている

**必要な作業**:
1. [`design_spec.md`](file:///c:/Antigravity/website/260115_onestruction/docs/design_spec.md)のセクション4.1を確認
2. Auto-hide仕様の正しいCSS定義を明記
3. Infrastructure担当に正確な仕様を伝達

---

#### Task 2: 3D軸表示の仕様確定

**現状**: research.mdでは「必須」、design_specでは詳細あり、実装は未実施

**必要な作業**:
1. 軸ラベル・目盛りの優先度を再確認（P0? P1? P2?）
2. Infrastructure担当に実装指示

---

### 🔬 Researcher担当への依頼（P2）

#### Task 1: 技術仕様の再検証

**問題**: research.md v7.0で「必須実装」とされた機能が未実装

**確認事項**:
- セクション2.3「3D空間認識技術」の軸ラベル・目盛りは本当に必須か？
- P0/P1/P2の優先度付けを再検討

---

## 5. 緊急修正の優先順位

### 🔴 P0（本日中に修正必須）

1. ツールバーの表示修正（1時間）
2. タスクバードラッグの修復（2時間）
3. タスクバーアイコンボタンの表示修正（2時間）
4. 付箋ドラッグ・削除の修復（2時間）

**合計見積もり**: 7時間

---

### 🟡 P1（1週間以内）

1. 工区切り替え機能の修復
2. レーン名編集機能の修復
3. タスク追加機能の修復
4. タスク色変更機能の修復
5. 3D軸ラベル・目盛りの実装

**合計見積もり**: 2-3日

---

### 🟢 P2（次バージョン）

1. タスクバー垂直リサイズ（I-V-6）
2. 付箋リサイズ機能
3. リサイズバー（画面分割）

---

## 6. 品質保証プロセスの改善提案

### 6.1 今回の問題の教訓

1. **「実装済み」の定義があいまい**
   - コードを書いた ≠ 動作する
   - ブラウザでの動作確認を必須とすべき

2. **ドキュメントと実機の検証を分離していた**
   - コードレビューだけでは不十分
   - 実機検証を必須プロセスに組み込むべき

3. **エビデンスの欠如**
   - スクリーンショット、動画を必須化すべき

---

### 6.2 新しい品質保証ルール（提案）

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   新・品質保証ルール                                     │
│                                                         │
│   1. 「実装完了」の定義                                  │
│      - コードを書いた                                   │
│      - ✅ ブラウザで動作確認した                         │
│      - ✅ スクリーンショットまたは動画を提出             │
│                                                         │
│   2. 検証の二段階制                                     │
│      - 実装者自身による動作確認（第一段階）              │
│      - QA担当による独立検証（第二段階）                  │
│                                                         │
│   3. エビデンスの必須化                                 │
│      - 各機能につき1枚以上のスクリーンショット           │
│      - P0機能は動画必須                                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 7. 結論

### 7.1 現時点での最終判定

**❌ 不合格（本番移行不可）**

**理由**:
1. P0機能の100%が動作していない
2. ツールバーが画面外に隠れている
3. SOP達成度が15%と極めて低い
4. 現場監督にとって一切価値がない状態

---

### 7.2 本番移行の条件

以下の全てを満たした場合のみ、本番移行を承認する:

- [ ] ツールバーが正しく表示される
- [ ] タスクバーをドラッグして時刻変更できる
- [ ] タスクバーの🎨✏️×ボタンが全て機能する
- [ ] 付箋をドラッグして移動できる
- [ ] 付箋の×ボタンで削除できる
- [ ] 📏ボタンで距離測定ができる
- [ ] 工区切り替えが正しく動作する
- [ ] ページリロード後もデータが保持される

**目標**: 上記8項目を全てクリアし、SOP達成度を最低60%以上にすること。

---

### 7.3 次のアクション

1. **即座**: Infrastructure担当にP0タスク（4件）を依頼
2. **1日後**: 修正版の実機検証を実施
3. **1週間後**: P1タスクの実装完了を確認
4. **2週間後**: 最終検証と本番移行判定

---

**作成者**: アナリティクス・品質担当  
**実機検証日**: 2026-01-18 17:38  
**レポート作成日**: 2026-01-18 20:48  
**次バージョン**: v16.0（P0修正完了後）

---

## 8. Infrastructure担当への質問

以下の質問に緊急で回答をお願いします:

1. **タスクバードラッグのコード（543-607行）は、どこから呼び出されていますか？**
2. **`setupTaskBar()`関数は実行されていますか？ブラウザコンソールで確認しましたか？**
3. **ツールバーの`top: -78px`は意図的な設定ですか？それともミスですか？**
4. **v5.0の「実装完了」報告は、ブラウザでの動作確認を行った上での報告ですか？**

この回答により、修正の方向性を決定します。

---

**以上**

| v13.0課題 | infra v5.0での主張 | 矛盾の有無 |
|:---|:---|:---|
| I-V-1: 測定ツール表示なし | **言及なし** | ⚠️ **未解決** |
| I-V-2: 付箋ドラッグ不可 | **言及なし** | ⚠️ **未解決** |
| I-V-3: 付箋削除不可 | **言及なし** | ⚠️ **未解決** |
| I-V-4: スケジュールドラッグ不可 | ✅ **実装済みと主張** | 🔴 **重大な矛盾** |
| I-V-5: スケジュール編集不可 | ✅ **実装済みと主張** | 🔴 **重大な矛盾** |

### 3.2 v13.0で報告されたP1改善要望の現状

| v13.0課題 | design_spec v9.0 | infra v5.0 | 判定 |
|:---|:---|:---|:---|
| D-V-1: ツールバー90px化 | ✅ 仕様反映済み（セクション4.1） | ❌ 未実装 | ⚠️ **実装待ち** |
| D-V-2: グリッド線調整 | 仕様なし | 🟡 提案あり | ⚠️ **仕様策定待ち** |

---

## 4. 最も重要な問題：実装と動作のギャップ

### 4.1 コードレビューと実機検証の矛盾

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   🔴 クリティカルギャップ検出                           │
│                                                         │
│   【状況】                                              │
│   ✅ infra v5.0: スケジュール機能実装完了と報告         │
│   ❌ 実機検証v13.0: 同機能が動作せず                    │
│                                                         │
│   【時系列】                                            │
│   07:05 - ユーザーが実機で「動かない」と報告            │
│   08:05 - インフラ担当が「実装済み」と報告              │
│                                                         │
│   【考えられる原因】                                    │
│   1. コードは書いたがイベントリスナー未登録             │
│   2. ブラウザキャッシュで古いコードが動作中             │
│   3. ビルドエラーで最新コードが反映されていない         │
│   4. 実装ファイルと読み込みファイルが異なる             │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 4.2 緊急対応が必要な理由

1. **ドキュメント上は実装済み**だが実機で動作しない状態は**最も危険**
2. 本番移行後に「動かない」クレームが発生するリスク
3. 品質保証プロセスの信頼性が損なわれる

---

## 5. 最終判定 ⚠️

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   ⚠️ 判定保留（緊急再実機検証が必要）                   │
│                                                         │
│   【判定理由】                                          │
│   🟡 infra v5.0で多数の機能実装を報告                  │
│   🔴 v13.0実機検証（07:05）では動作せず                │
│   ⏰ わずか1時間後に「実装完了」報告                   │
│   ❓ 実装とデプロイのタイムラグの可能性                 │
│                                                         │
│   【SOP達成度】 推定70%（実機検証次第で変動）          │
│                                                         │
│   【本番移行可否】 ❌ 再実機検証完了まで保留            │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 6. 緊急タスク（優先順位順）

### 🔴 最優先（P0）: 再実機検証

**担当**: Analytics担当（私）  
**期限**: 即時

**検証項目**:
1. ブラウザのハードリフレッシュ（Ctrl+Shift+R）を実行
2. 開発サーバーを再起動（`npm run dev`）
3. 以下の機能を実際に操作:
   - [ ] タスクバーをドラッグできるか
   - [ ] タスクバーの「×」ボタンで削除できるか
   - [ ] タスクバーの「🎨」ボタンで色変更できるか
   - [ ] レーン名をクリックして編集できるか
   - [ ] 付箋をドラッグできるか
   - [ ] 付箋の「×」ボタンで削除できるか
   - [ ] 📏ボタンで距離測定できるか

### 🟡 次優先（P1）: ドキュメントと実装の完全同期

**担当**: Infrastructure担当

**作業内容**:
1. infra v5.0で「実装済み」と報告した機能が実際にブラウザで動作することを**自ら確認**
2. 動作しない場合は、実装の問題箇所を特定し修正
3. 検証動画またはスクリーンショットを提供

### 🟡 次優先（P1）: デザイン仕様の実装

**担当**: Designer担当 + Infrastructure担当

**作業内容**:
1. **D-V-1**: ツールバーボタンサイズを90pxに変更
   - [`style.css:20`](file:///c:/Antigravity/website/260115_onestruction/style.css#L20)を編集
2. **D-V-2**: スケジュールグリッド線の調整
   - 時刻ラベルとグリッド線の間隔を一致させる

---

## 7. ドキュメント品質の評価

### 7.1 達成された点 ✅

- **design_spec.md v9.0**: 明確な仕様定義、90px化・リサイズバーの追記
- **infra_setup_guide.md v5.0**: 詳細な実装報告、ファイルパスと行番号の明記
- **ドキュメント整合性**: 両者の参照関係が明確

### 7.2 改善が必要な点 ❌

- **実装報告の検証不在**: 「実装した」と報告する前にブラウザ確認が必須
- **時系列の混乱**: 実機検証の「動かない」報告後に「実装済み」報告
- **エビデンス不足**: スクリーンショットや動画による証拠がない

---

## 8. 再実機検証後のアクションプラン

### パターンA: infra v5.0の実装が動作している場合

**結論**: v13.0の検証が古いキャッシュで行われていた

**対応**:
1. final_quality_report.md を v15.0 に更新
2. SOP達成度を85%に再評価
3. 残りのP1課題（ツールバー90px、グリッド調整、リサイズバー）を実装
4. 本番移行を承認

### パターンB: infra v5.0の実装が動作していない場合

**結論**: ドキュメントと実装に乖離がある

**対応**:
1. Infrastructure担当に差し戻し
2. infra_setup_guide.md v5.0の「実装完了」報告を「実装中」に訂正
3. 実際に動作するコードを実装後、再提出
4. Analytics担当が再検証

---

## 9. 結論と次のステップ

### 現時点での結論

**「ドキュメント品質は高いが、実装品質は未確定」**

### 緊急推奨事項

1. **即座にブラウザで再実機検証を実施**（ハードリフレッシュ必須）
2. **動作する機能と動作しない機能を明確に分類**
3. **エビデンスベースの品質評価に移行**（スクリーンショット、動画、ログ）

### 品質保証プロセスの改善提案

今後、以下のルールを導入することを強く推奨します:

1. **実装完了の定義**: 「ブラウザで動作確認完了」を必須とする
2. **エビデンス提出**: スクリーンショットまたは録画を必須とする
3. **相互検証**: 実装者自身による検証 + QA担当による検証の二段階制

---

**作成者**: アナリティクス・品質担当  
**コードレビュー日**: 2026-01-17 22:50  
**実機検証日**: 2026-01-18 07:05  
**ドキュメント検証日**: 2026-01-18 08:18  
**次バージョン**: v15.0（再実機検証完了後）

---

## 10. Infrastructure担当への質問

以下の質問に回答をお願いします:

1. **タイミング確認**: v13.0実機検証（07:05）は、あなたのv5.0実装（08:05報告）の**前**ですか、**後**ですか？
2. **動作確認**: v5.0で報告した機能（タスクバードラッグ等）を、あなた自身が**ブラウザで動作確認**しましたか？
3. **デプロイ確認**: コードを書いた後、開発サーバーを**再起動**しましたか？
4. **イベント確認**: `addEventListener`が正しく実行されているか、**ブラウザのコンソールで確認**しましたか？

この回答により、次のアクションを決定します。

---

## 11. 新規実機検証結果（2026-01-18 10:10追加）

### 11.1 検証環境と提出エビデンス

- **検証日時**: 2026-01-18 10:10
- **検証者**: ユーザー（現場監督視点）
- **エビデンス**: 添付画像あり

![新規指摘事項モーダル - アイコンサイズと統一性の問題](file:///C:/Users/omele_uw5enx6/.gemini/antigravity/brain/eb46aeb2-9d29-4779-b04b-38889de780ab/uploaded_image_1768698590704.png)

*画像：「新規指摘事項」モーダル。アイコンが小さく、一貫性がない問題を示している*

### 11.2 発見された新規要望（8件）

以下、ユーザーからの実機検証による改善要望を整理しました。

---

## 12. 担当者別タスクリスト

### 🎨 Designer担当の新規タスク

#### D-V-3: アイコンの統一性確保 【優先度: P1】

**問題**: 
- ツールバーの「新規指摘事項」ボタンのアイコンと、モーダル内のアイコンが異なる
- 添付画像参照：モーダル左上のアイコンとツールバーアイコンの不一致

**要件**:
- ツールバーボタンと対応するモーダルのアイコンを統一
- 特に「新規指摘事項」（📌）の一貫性を確保

**修正箇所**: 
- [`index.html`](file:///c:/Antigravity/website/260115_onestruction/index.html) - モーダルのアイコン定義
- [`design_spec.md`](file:///c:/Antigravity/website/260115_onestruction/docs/design_spec.md) - アイコン仕様の明確化

**実装方法**:
```html
<!-- ツールバーボタン -->
<button class="tool-btn" data-tool="annotation">
  <span class="icon">📌</span>
</button>

<!-- モーダルヘッダー（統一） -->
<div class="modal-header">
  <span class="icon">📌</span> <!-- ここを統一 -->
  <h2>新規指摘事項</h2>
</div>
```

---

#### D-V-4: モーダルUIの全体的な拡大 【優先度: P0】

**問題**: 
「新規指摘事項」モーダル内の全要素が小さすぎる（添付画像参照）:
- アイコンボタン（✅❓⚠️💬⭐📝）
- テキストエリア
- ボタン（「是正確認」「KY」「安全」など）
- 「写真を追加」ボタン

**要件**:
現場での視認性・操作性を考慮し、以下のサイズに拡大:
- **アイコンボタン**: 現在の1.5倍（60px → **90px**）
- **フォントサイズ**: 14px → **18px**
- **テキストエリア**: 高さ 60px → **100px**
- **ボタン**: 高さ 36px → **50px**

**修正箇所**: [`style.css`](file:///c:/Antigravity/website/260115_onestruction/style.css)

**実装例**:
```css
/* モーダル内アイコンボタン */
.icon-selector .icon-btn {
  width: 90px;  /* 現在: 60px */
  height: 90px; /* 現在: 60px */
  font-size: 48px; /* 現在: 32px */
}

/* テキストエリア */
.comment-input {
  font-size: 18px; /* 現在: 14px */
  min-height: 100px; /* 現在: 60px */
  padding: 16px; /* 現在: 8px */
}

/* アクションボタン */
.modal-footer button,
.tag-btn {
  height: 50px; /* 現在: 36px */
  font-size: 16px; /* 現在: 14px */
  padding: 12px 24px; /* 現在: 8px 16px */
}
```

---

#### D-V-5: 軸目盛りデザイン仕様 【優先度: P1】

**要件**: 
X/Y/Z軸に5m間隔の目盛りを表示（0, 5m, 10m, 15m...）

**デザイン仕様**:
```css
.axis-label {
  font-family: var(--font-system);
  font-size: 14px;
  color: #666666;
  background: rgba(255, 255, 255, 0.8);
  padding: 2px 6px;
  border-radius: 3px;
}
```

**配色**:
- X軸: 赤系（#E53935）
- Y軸: 緑系（#43A047）
- Z軸: 青系（#1E88E5）

---

#### D-V-6: 付箋リサイズハンドルデザイン 【優先度: P2】

**要件**: 
付箋の右下にリサイズハンドルを配置

**デザイン仕様**:
```css
.sticky-note .resize-handle {
  position: absolute;
  right: 0;
  bottom: 0;
  width: 20px;
  height: 20px;
  background: 
    linear-gradient(135deg, transparent 50%, #999 50%);
  cursor: nwse-resize;
}
```

---

### 💻 Infrastructure担当の新規タスク

#### I-V-6: タスクバー両端ドラッグ調整機能 【優先度: P0】

**要望**: 
「上下に関しては、赤く線が表示されるのはいいのですが、微調整できるように、後から両端を伸ばしたり縮めたり、マウスで操作できるようにしたい」

**要件**:
- タスクバーの上端・下端にリサイズハンドルを表示
- ドラッグで開始時刻・終了時刻を個別に調整可能
- 40pxグリッド（15分単位）にスナップ

**実装方法**:
```javascript
// タスクバー生成時にリサイズハンドルを追加
const topHandle = document.createElement('div');
topHandle.className = 'task-resize-handle top';
taskBar.appendChild(topHandle);

const bottomHandle = document.createElement('div');
bottomHandle.className = 'task-resize-handle bottom';
taskBar.appendChild(bottomHandle);

// ドラッグイベント
topHandle.addEventListener('mousedown', (e) => {
  e.stopPropagation();
  dragTarget = 'task-resize-top';
  // ... リサイズロジック
});

bottomHandle.addEventListener('mousedown', (e) => {
  e.stopPropagation();
  dragTarget = 'task-resize-bottom';
  // ... リサイズロジック
});
```

**CSS**:
```css
.task-resize-handle {
  position: absolute;
  left: 0;
  right: 0;
  height: 8px;
  cursor: ns-resize;
  background: rgba(255, 0, 0, 0.3);
  z-index: 10;
}

.task-resize-handle.top {
  top: 0;
}

.task-resize-handle.bottom {
  bottom: 0;
}

.task-resize-handle:hover {
  background: rgba(255, 0, 0, 0.6);
}
```

---

#### I-V-7: 3D空間の軸ラベル表示 【優先度: P1】

**要望**: 
「X軸、Y軸、Z軸と分かるように表示をしてもらいたいです」

**実装箇所**: [`src/bim-viewer.js`](file:///c:/Antigravity/website/260115_onestruction/src/bim-viewer.js)の `setupScene()`

**実装方法**:
```javascript
// setupScene() 内に追加
import { CSS2DRenderer, CSS2DObject } from 'three/examples/jsm/renderers/CSS2DRenderer.js';

// 軸ラベル作成関数
function createAxisLabel(text, color) {
  const div = document.createElement('div');
  div.className = 'axis-label';
  div.textContent = text;
  div.style.color = color;
  return new CSS2DObject(div);
}

// X軸ラベル（赤）
const xLabel = createAxisLabel('X軸', '#E53935');
xLabel.position.set(55, 0, 0);
this.scene.add(xLabel);

// Y軸ラベル（緑）
const yLabel = createAxisLabel('Y軸', '#43A047');
yLabel.position.set(0, 55, 0);
this.scene.add(yLabel);

// Z軸ラベル（青）
const zLabel = createAxisLabel('Z軸', '#1E88E5');
zLabel.position.set(0, 0, 55);
this.scene.add(zLabel);

// CSS2DRendererの初期化
this.labelRenderer = new CSS2DRenderer();
this.labelRenderer.setSize(this.container.clientWidth, this.container.clientHeight);
this.labelRenderer.domElement.style.position = 'absolute';
this.labelRenderer.domElement.style.top = '0';
this.labelRenderer.domElement.style.pointerEvents = 'none';
this.container.appendChild(this.labelRenderer.domElement);

// animate() 内でレンダリング
this.labelRenderer.render(this.scene, this.camera);
```

---

#### I-V-8: 軸目盛り表示（5m間隔） 【優先度: P1】

**要望**: 
「X軸、Y軸、Z軸には、何メーターか分かるように、原点から5メーター、10メーター、15メーターと5メーターごとにメモリをつけてほしい」

**実装方法**:
```javascript
// setupScene() 内に追加
function addAxisTicks(axis, color) {
  const material = new THREE.LineBasicMaterial({ color });
  
  for (let i = 5; i <= 50; i += 5) {
    // 目盛り線
    const tickGeometry = new THREE.BufferGeometry().setFromPoints([
      new THREE.Vector3(...getTickStart(axis, i)),
      new THREE.Vector3(...getTickEnd(axis, i))
    ]);
    const tick = new THREE.Line(tickGeometry, material);
    this.scene.add(tick);
    
    // 目盛りラベル
    const label = createAxisLabel(`${i}m`, color);
    label.position.set(...getLabelPosition(axis, i));
    this.scene.add(label);
  }
}

// 各軸に目盛りを追加
addAxisTicks('x', 0xE53935); // 赤
addAxisTicks('y', 0x43A047); // 緑
addAxisTicks('z', 0x1E88E5); // 青
```

---

#### I-V-9: ツールバーに付箋追加アイコン 【優先度: P1】

**要望**: 
「新しくヘッドバーとして付箋を追加するための付箋のアイコンが欲しいです」

**実装方法**:
```html
<!-- index.html のツールバーに追加 -->
<button class="tool-btn" data-tool="sticky-note" aria-label="付箋を追加">
  <span class="icon">🗒️</span>
</button>
```

```javascript
// main.js に追加
document.querySelector('[data-tool="sticky-note"]').addEventListener('click', () => {
  // 3D空間の中心付近にランダムな位置で付箋を作成
  const newNote = createStickyNote({
    x: Math.random() * 200 - 100,
    y: Math.random() * 200 - 100,
    text: '新しい付箋',
    color: 'yellow'
  });
  
  setupStickyNote(newNote);
  saveStickyData();
  showNotification('📝 付箋を追加しました');
});
```

---

#### I-V-10: ツールバー操作性改善 【優先度: P2】

**要望**: 
「ヘッドバー右側の3本線にマウスでクリックに行けません。ですので、そちらはヘッドバーが表示されているとき、上端をすべていじれるようにしてほしいです」

**問題**: 
現在のAuto-hide実装では、ホバー範囲が狭すぎる

**解決策**:
```css
/* style.css */
.tools-header {
  transform: translateY(-80%); /* 現在 */
  transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
  /* 上端に常に操作可能なエリアを残す */
}

/* ホバー可能な領域を拡大 */
.tools-header::before {
  content: '';
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  height: 30px; /* ホバー検出範囲を拡大 */
  pointer-events: auto;
}

.tools-header:hover,
.tools-header::before:hover + .tools-header {
  transform: translateY(0);
}
```

---

#### I-V-11: 付箋リサイズ機能 【優先度: P2】

**要望**: 
「付箋に縦横の長さを変更できるようなもの欲しいです」

**実装方法**:
```javascript
// setupStickyNote() 内に追加
const resizeHandle = document.createElement('div');
resizeHandle.className = 'resize-handle';
note.appendChild(resizeHandle);

let isResizing = false;
let resizeStartPos = null;
let resizeStartSize = null;

resizeHandle.addEventListener('mousedown', (e) => {
  e.stopPropagation();
  isResizing = true;
  resizeStartPos = { x: e.clientX, y: e.clientY };
  resizeStartSize = {
    width: note.offsetWidth,
    height: note.offsetHeight
  };
});

document.addEventListener('mousemove', (e) => {
  if (!isResizing) return;
  
  const dx = e.clientX - resizeStartPos.x;
  const dy = e.clientY - resizeStartPos.y;
  
  note.style.width = `${Math.max(150, resizeStartSize.width + dx)}px`;
  note.style.height = `${Math.max(100, resizeStartSize.height + dy)}px`;
});

document.addEventListener('mouseup', () => {
  if (isResizing) {
    isResizing = false;
    saveStickyData(); // サイズを保存
  }
});
```

---

## 13. 修正完了基準（新規要望）

以下を実機で確認すること:

### P0タスク（最優先）
- [ ] タスクバーの上端・下端をドラッグして、開始/終了時刻を個別に調整できる
- [ ] 「新規指摘事項」モーダルの全要素（アイコン、ボタン、テキストエリア）が拡大表示される

### P1タスク（高優先）
- [ ] 3D空間にX/Y/Z軸のラベルが表示される
- [ ] 各軸に5m間隔で目盛りとラベル（「5m」「10m」...）が表示される
- [ ] ツールバーの「付箋追加」ボタン（🗒️）で新しい付箋を追加できる
- [ ] ツールバーと「新規指摘事項」モーダルのアイコンが統一されている

### P2タスク（中優先）
- [ ] ツールバーのホバー検出範囲が拡大し、操作しやすくなっている
- [ ] 付箋の右下をドラッグして、サイズを変更できる

---

## 14. SOP達成度の再評価（新規要望反映後）

### 予測される達成度

新規要望（8件）をすべて実装した場合:

| SOP項目 | 達成度 | 評価 |
|:---|:---|:---|
| 3Dモデル表示 | ✅ 達成 | 軸ラベル・目盛り追加で空間把握が向上 |
| アナログ情報管理 | ✅ 達成 | 付箋追加ボタン・リサイズで使い勝手向上 |
| 工程管理 | ✅ 達成 | タスクバー調整機能で精密な時刻設定が可能 |
| 現場での実用性 | ✅ 達成 | モーダルUI拡大で視認性・操作性が大幅向上 |

**予測SOP達成度**: **95%** (現行60% → +35%)

---

## 15. 最終判定（新規要望反映版）

```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│   🟡 条件付き合格（新規要望対応後）                     │
│                                                         │
│   【判定理由】                                          │
│   ✅ ユーザーからの具体的なフィードバックを獲得          │
│   ✅ エビデンス（画像）付きで問題点が明確              │
│   🔶 8件の新規要望は重要度が高い                       │
│   🔶 特にモーダルUI拡大（P0）は緊急対応が必要          │
│                                                         │
│   【推奨アクション】                                    │
│   1. P0タスク（2件）を最優先で実装                    │
│   2. P1タスク（5件）を順次実装                        │
│   3. 実装完了後、再度実機検証を実施                    │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

**作成者**: アナリティクス・品質担当  
**新規検証日**: 2026-01-18 10:10  
**ステータス**: 新規要望8件を受領、担当者別タスク化完了  
**次バージョン**: v16.0（新規要望実装完了後）

